{% if enable_jsonld_workflows -%}
name: Update JSONLD

on: 
  push:
    branches-ignore:
      - production

jobs:
  update-jsonld:
    runs-on: ubuntu-latest
      
    steps:
    - name: Install CMIP-LD
      id: install-cmipld
      uses: {{ github_username }}/CMIP-LD/actions/cmipld@main
    
    - name: Checkout Code
      uses: actions/checkout@v4
      with:
        fetch-depth: 2

    - name: Set up Git
      run: |
        git pull

    - name: Get a list of directories with updated files
      id: updated-dirs
      uses: {{ github_username }}/CMIP-LD/actions/updated-dirs@main
      with:
        filter_dir: "src-data"

    - name: Group JSONLD files
      id: group-jsonld
      uses: {{ github_username }}/CMIP-LD/actions/process_jsonld@main
      with:
        {% raw %}dirs: ${{ env.updated_dirs }}{% endraw %}

    - name: Generate summaries
      id: gen-summary
      run: |
        generate_summary .github/GENERATE_SUMMARY/

    - name: Commit All
      uses: {{ github_username }}/CMIP-LD/actions/commit-all@main
      with:
        message: "Automated Content Update"

    - name: Push PR
      uses: {{ github_username }}/CMIP-LD/actions/pushpr@main
      with:
          message: "Automated JSONLD update"
          {% raw %}token: ${{ secrets.GITHUB_TOKEN }}{% endraw %}

    - name: Publish
      if: github.ref_name == 'main'
      uses: {{ github_username }}/CMIP-LD/actions/publish2pages@main
      with:
        {% raw %}api_key: ${{ secrets.API_KEY }}
        github_token: ${{ secrets.GITHUB_TOKEN }}
        branch_name: ${{ github.ref_name }}{% endraw %}
{% endif -%}
